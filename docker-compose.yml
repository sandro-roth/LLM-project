services:
  inference:
    build:
      context: .
      dockerfile: LLMs/Inference.Dockerfile
      target: ${DOCKER_INFERENCE}
      args:
        DOCKER_INFERENCE: ${DOCKER_INFERENCE}
        USE_PROXY: ${USE_PROXY}
        HTTP_PROXY: ${HTTP_PROXY}
        HTTPS_PROXY: ${HTTPS_PROXY}
        NO_PROXY: ${NO_PROXY}
        LOG_DIR: ${LOG_DIR}
    container_name: llm-inference
    ports:
      - "8100:8100"
    restart: "no"
    volumes:
      - ./LLMs/Mistral7B:/app/Mistral7B
      - ./LLMs/Meditron7B:/app/Meditron7B
    gpus: all
    environment:
      - NVIDIA_VISIBLE_DEVICES=0
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
    # === Limits (hinzugefügt) ===
    cpus: "8"
    mem_limit: "32g"
    mem_reservation: "16g"
    pids_limit: 2048
    ulimits:
      nofile: 65536

  streamlit-web:
    build:
      context: .
      dockerfile: webinterface/Dockerfile
      args:
        USE_PROXY: ${USE_PROXY}
        HTTP_PROXY: ${HTTP_PROXY}
        HTTPS_PROXY: ${HTTPS_PROXY}
        NO_PROXY: ${NO_PROXY}
        LOG_DIR: ${LOG_DIR}
    container_name: streamlit-web-app
    ports:
      - "8501:8501"
    environment:
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_HEADLESS=true
      - API_BASE_URL=${API_BASE_URL}
      - DOCKER_INFERENCE=${DOCKER_INFERENCE}

    # === Limits (hinzugefügt) ===
    cpus: "2"
    mem_limit: "2g"
    mem_reservation: "1g"
    pids_limit: 512
    ulimits:
      nofile: 8192